<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>X-Wing Custom Base Creator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: #f5f5f5;
            color: #333;
        }
        .section-header {
            cursor: pointer;
            user-select: none;
        }
        .section-header:hover {
            background-color: #f3f4f6 !important;
        }
        .section-content {
            max-height: 2000px;
            overflow: visible;
            transition: max-height 0.3s ease-out, padding 0.3s ease-out;
        }
        .section-content.collapsed {
            max-height: 0;
            padding-top: 0 !important;
            padding-bottom: 0 !important;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50">
    <div class="container mx-auto px-4 py-6">
        <!-- Header -->
        <header class="mb-6">
            <h1 class="text-3xl font-bold text-gray-800">
                X-Wing Custom Base Creator
            </h1>
            <p class="text-gray-600 text-sm mt-1">Design your custom ship bases for X-Wing Miniatures Game</p>
        </header>

        <!-- Main Content -->
        <div class="flex flex-col lg:flex-row gap-4 h-full">
            <!-- Left Panel - Toolbox (30%) -->
            <div class="w-full lg:w-[30%] bg-white rounded-lg shadow-md overflow-hidden">

                <!-- Base Configuration Section -->
                <div class="border-b border-gray-200">
                    <div class="section-header px-4 py-3 bg-gray-50 hover:bg-gray-100" onclick="toggleSection('base-config')">
                        <h2 class="text-sm font-semibold text-gray-800">üéØ Base Configuration</h2>
                    </div>
                    <div id="base-config" class="section-content px-4 py-4 space-y-4">
                        <!-- Base Size Selection -->
                        <div>
                            <label class="block text-xs font-medium mb-2 text-gray-700">Base Size</label>
                            <select
                                id="base-size-select"
                                class="w-full py-2 px-3 rounded border border-gray-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none bg-white text-gray-900"
                                onchange="handleBaseSizeChange()"
                                aria-label="Select base size">
                                <option value="small">Small Base</option>
                                <option value="medium">Medium Base</option>
                                <option value="large">Large Base</option>
                            </select>
                        </div>

                        <!-- Faction Selection -->
                        <div>
                            <label class="block text-xs font-medium mb-2 text-gray-700">Faction</label>
                            <select
                                id="faction-select"
                                class="w-full py-2 px-3 rounded border border-gray-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none bg-white text-gray-900"
                                onchange="handleFactionChange()"
                                aria-label="Select faction">
                                <option value="none">No Faction</option>
                                <option value="rebel-alliance" selected>Rebel Alliance</option>
                                <option value="galactic-empire">Galactic Empire</option>
                                <option value="scum-and-villainy">Scum and Villainy</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Arcs Section -->
                <div class="border-b border-gray-200">
                    <div class="section-header px-4 py-3 bg-gray-50 hover:bg-gray-100" onclick="toggleSection('arcs')">
                        <h2 class="text-sm font-semibold text-gray-800">üé≤ Firing Arcs</h2>
                    </div>
                    <div id="arcs" class="section-content px-4 py-4 space-y-4">
                        <!-- Front Arc Selection -->
                        <div>
                            <label class="block text-xs font-medium mb-2 text-gray-700">Front Arc</label>
                            <select
                                id="front-arc-select"
                                class="w-full py-2 px-3 rounded border border-gray-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none bg-white text-gray-900"
                                onchange="handleArcChange()"
                                aria-label="Select front arc type">
                                <option value="none">None</option>
                                <option value="frontarc">Front Arc</option>
                                <option value="fullfrontarc">Full Front Arc</option>
                                <option value="bullseyearc">Bullseye Arc</option>
                            </select>
                        </div>

                        <!-- Back Arc Selection -->
                        <div>
                            <label class="block text-xs font-medium mb-2 text-gray-700">Back Arc</label>
                            <select
                                id="back-arc-select"
                                class="w-full py-2 px-3 rounded border border-gray-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none bg-white text-gray-900"
                                onchange="handleArcChange()"
                                aria-label="Select back arc type">
                                <option value="none">None</option>
                                <option value="reararc">Rear Arc</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Pilot Information Section -->
                <div class="border-b border-gray-200">
                    <div class="section-header px-4 py-3 bg-gray-50 hover:bg-gray-100" onclick="toggleSection('pilot-info')">
                        <h2 class="text-sm font-semibold text-gray-800">‚úèÔ∏è Pilot Information</h2>
                    </div>
                    <div id="pilot-info" class="section-content px-4 py-4 space-y-4">
                        <!-- Pilot Information -->
                        <div id="pilot-info-section" class="space-y-3">
                            <div>
                                <label for="pilot-name" class="block text-xs font-medium text-gray-700 mb-1">Pilot Name</label>
                                <input
                                    type="text"
                                    id="pilot-name"
                                    class="w-full py-2 px-3 rounded border border-gray-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none bg-white text-gray-900"
                                    placeholder="Enter pilot name"
                                    oninput="handlePilotInfoChange()"
                                    aria-label="Pilot name input">
                            </div>
                            <div>
                                <label for="initiative" class="block text-xs font-medium text-gray-700 mb-1">Initiative</label>
                                <input
                                    type="number"
                                    id="initiative"
                                    min="0"
                                    max="12"
                                    class="w-full py-2 px-3 rounded border border-gray-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none bg-white text-gray-900"
                                    placeholder="0-12"
                                    oninput="handlePilotInfoChange()"
                                    aria-label="Initiative number input">
                            </div>
                            <div>
                                <label for="ship-icon" class="block text-xs font-medium text-gray-700 mb-1">Ship Icon (Optional)</label>
                                <input
                                    type="file"
                                    id="ship-icon"
                                    accept="image/*"
                                    class="w-full py-2 px-3 rounded border border-gray-300 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none bg-white text-gray-900 text-xs"
                                    onchange="handleShipIconChange()"
                                    aria-label="Upload ship icon">
                                <p class="text-xs text-gray-500 mt-1">Upload a custom ship icon for the nameplate</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Export Section -->
                <div>
                    <div class="section-header px-4 py-3 bg-gray-50 hover:bg-gray-100" onclick="toggleSection('export')">
                        <h2 class="text-sm font-semibold text-gray-800">üíæ Export</h2>
                    </div>
                    <div id="export" class="section-content px-4 py-4">
                        <button
                            class="w-full py-2 px-4 rounded bg-blue-600 hover:bg-blue-700 transition-colors text-white text-sm font-medium shadow-sm"
                            onclick="handleExport()"
                            tabindex="0"
                            aria-label="Export base design">
                            Export Design
                        </button>
                    </div>
                </div>

                <!-- Ko-fi Widget -->
                <div class="p-4 border-t border-gray-200 flex justify-center">
                    <script type='text/javascript' src='https://storage.ko-fi.com/cdn/widget/Widget_2.js'></script><script type='text/javascript'>kofiwidget2.init('Support me on Ko-fi', '#72a4f2', 'N4N31OKJL8');kofiwidget2.draw();</script>
                </div>

                <!-- Tool layer bottom text -->
                <div class="p-4 border-t border-gray-200">
                    <div class="text-center text-xs text-gray-500" style="font-size: 10px; color: #888888;">
                        Created by <strong>Stealthizer</strong>. Visit the
                        <a href="https://github.com/stealthizer/xwing-custom-base" target="_blank" class="text-blue-600 hover:text-blue-800 underline">Github project page</a>
                        <br>
                        Last updated: <span id="lastUpdated"></span>
                    </div>
                </div>
            </div>

            <!-- Right Panel - Canvas (70%) -->
            <div class="w-full lg:w-[70%] bg-white rounded-lg shadow-md p-6 flex flex-col">
                <h2 class="text-lg font-semibold text-gray-800 mb-4">Preview</h2>

                <div class="flex-1 flex items-center justify-center bg-gray-100 rounded-lg border-2 border-dashed border-gray-300 min-h-96">
                    <div id="preview-container" class="relative">
                        <div id="preview-placeholder" class="text-center text-gray-400">
                            <svg class="w-20 h-20 mx-auto mb-3 opacity-40" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                            <p class="text-lg">Select a base size to begin</p>
                        </div>

                        <!-- Canvas for composite image -->
                        <canvas id="preview-canvas" class="hidden"></canvas>
                        <img id="preview-image" class="hidden max-w-full h-auto" alt="Base preview">
                    </div>
                </div>

                <!-- Info Panel - Current Selection Tooltip -->
                <div class="mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200">
                    <div class="flex items-start space-x-2">
                        <svg class="w-5 h-5 text-blue-500 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <div>
                            <h3 class="text-xs font-semibold text-blue-700 mb-0.5">Current Selection</h3>
                            <p id="info-text" class="text-xs text-gray-600">No base selected</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
